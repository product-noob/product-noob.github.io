---
/**
 * BaseLayout — shared HTML shell for every page on the site.
 * Handles meta tags, Open Graph, Twitter cards, JSON-LD structured data,
 * global styles, header, footer, and analytics.
 */

interface BreadcrumbItem {
  name: string;
  url?: string;
}

interface Props {
  /** Page <title> */
  title: string;
  /** Meta description (max ~155 chars for best display) */
  description?: string;
  /** Open Graph image URL — defaults to profile photo */
  ogImage?: string;
  /** Alt text for OG/Twitter image */
  ogImageAlt?: string;
  /** Open Graph type — "website" (default) or "article" for blog posts */
  ogType?: "website" | "article";
  /** ISO date string for article:published_time */
  publishedTime?: string;
  /** ISO date string for article:modified_time */
  modifiedTime?: string;
  /** Tags for article:tag meta */
  articleTags?: string[];
  /** Breadcrumb trail for BreadcrumbList schema */
  breadcrumbs?: BreadcrumbItem[];
  /** Image to preload (e.g. hero LCP image) */
  preloadImage?: string;
  /** Extra JSON-LD structured data to inject alongside the default schemas */
  extraSchema?: Record<string, unknown>;
}

import "../styles/tokens.css";
import "../styles/reset.css";
import "../styles/global.css";
import "../styles/components.css";

const {
  title,
  description = "Prince Jain — Group Product Manager at Flipkart. Building AI products at scale.",
  ogImage = "https://princejain.me/profile-photo-1.webp",
  ogImageAlt = "Prince Jain — Product Leader & Builder",
  ogType = "website",
  publishedTime,
  modifiedTime,
  articleTags,
  breadcrumbs,
  preloadImage,
  extraSchema,
} = Astro.props;

const canonicalUrl = new URL(
  Astro.url.pathname,
  Astro.site
).toString();

const siteUrl = "https://princejain.me";
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="theme-color" content="#FAF9F6" />

    <!-- Preload critical fonts (self-hosted, eliminates cross-origin chain) -->
    <link rel="preload" href="/fonts/dm-sans-latin.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/fraunces-latin.woff2" as="font" type="font/woff2" crossorigin />

    {/* Optionally preload an LCP image (e.g. hero photo on homepage) */}
    {preloadImage && (
      <link rel="preload" as="image" href={preloadImage} />
    )}

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/favicon.svg" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalUrl} />

    <!-- RSS Feed -->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Prince Jain — Blog"
      href="/rss.xml"
    />

    <!-- Open Graph / Social -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="800" />
    <meta property="og:image:height" content="800" />
    <meta property="og:image:alt" content={ogImageAlt} />
    <meta property="og:site_name" content="Prince Jain" />
    <meta property="og:locale" content="en_US" />

    {/* Article-specific OG tags (only for blog posts) */}
    {ogType === "article" && publishedTime && (
      <meta property="article:published_time" content={publishedTime} />
    )}
    {ogType === "article" && modifiedTime && (
      <meta property="article:modified_time" content={modifiedTime} />
    )}
    {ogType === "article" && (
      <meta property="article:author" content="https://princejain.me" />
    )}
    {ogType === "article" && articleTags?.map((tag) => (
      <meta property="article:tag" content={tag} />
    ))}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@Prince_Jain17" />
    <meta name="twitter:creator" content="@Prince_Jain17" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <meta name="twitter:image:alt" content={ogImageAlt} />

    <title>{title}</title>

    <!-- JSON-LD: Person (site-wide identity) -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Person",
        name: "Prince Jain",
        url: siteUrl,
        image: `${siteUrl}/profile-photo-1.webp`,
        jobTitle: "Group Product Manager",
        worksFor: {
          "@type": "Organization",
          name: "Flipkart",
        },
        sameAs: [
          "https://twitter.com/Prince_Jain17",
          "https://linkedin.com/in/princejain17",
          "https://github.com/product-noob",
        ],
        description:
          "Group Product Manager at Flipkart building AI products at scale.",
      })}
    />

    <!-- JSON-LD: WebSite (enables sitelinks search box) -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        name: "Prince Jain",
        url: siteUrl,
        description: "Personal website and blog of Prince Jain — Product Leader at Flipkart building AI products at scale.",
      })}
    />

    {/* JSON-LD: BreadcrumbList (per-page navigation context) */}
    {breadcrumbs && breadcrumbs.length > 0 && (
      <script
        type="application/ld+json"
        set:html={JSON.stringify({
          "@context": "https://schema.org",
          "@type": "BreadcrumbList",
          itemListElement: breadcrumbs.map((crumb, index) => ({
            "@type": "ListItem",
            position: index + 1,
            name: crumb.name,
            ...(crumb.url ? { item: crumb.url } : {}),
          })),
        })}
      />
    )}

    {/* JSON-LD: Extra page-specific schema (e.g. BlogPosting) */}
    {extraSchema && (
      <script
        type="application/ld+json"
        set:html={JSON.stringify(extraSchema)}
      />
    )}

  </head>
  <body>
    <header class="header">
      <div class="header__container container">
        <a href="/" class="header__logo">
          <span class="header__name">Prince Jain</span>
        </a>
        <nav class="header__nav" aria-label="Main navigation">
          <a
            href="/blogs"
            class={`nav-link ${
              Astro.url.pathname.startsWith("/blogs") ? "nav-link--active" : ""
            }`}>Blog</a
          >

          <a
            href="/work"
            class={`nav-link ${
              Astro.url.pathname === "/work" ? "nav-link--active" : ""
            }`}>Work</a
          >
          <a
            href="/links"
            class={`nav-link ${
              Astro.url.pathname === "/links" ? "nav-link--active" : ""
            }`}>Links</a
          >
          <a
            href="/about"
            class={`nav-link ${
              Astro.url.pathname === "/about" ? "nav-link--active" : ""
            }`}>About</a
          >
        </nav>
        <button
          class="header__menu-btn"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer class="footer">
      <div class="footer__container container">
        <div class="footer__social">
          <a
            href="https://twitter.com/Prince_Jain17"
            class="footer__social-link"
            aria-label="Twitter"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
              ></path>
            </svg>
          </a>
          <a
            href="https://linkedin.com/in/princejain17"
            class="footer__social-link"
            aria-label="LinkedIn"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
              ></path>
            </svg>
          </a>
          <a
            href="https://github.com/product-noob"
            class="footer__social-link"
            aria-label="GitHub"
            target="_blank"
            rel="noopener noreferrer"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"
              ></path>
            </svg>
          </a>
          <a
            href="mailto:princemnit@gmail.com"
            class="footer__social-link"
            aria-label="Email"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="2" y="4" width="20" height="16" rx="2"></rect>
              <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
            </svg>
          </a>
        </div>
        <p class="footer__copyright">
          © {new Date().getFullYear()} Prince Jain. All rights reserved.
        </p>
      </div>
    </footer>

    <!-- Google Analytics — deferred to avoid blocking initial render -->
    <script is:inline>
      (function() {
        function loadGA() {
          var s = document.createElement('script');
          s.src = 'https://www.googletagmanager.com/gtag/js?id=G-WZLF9K3MJB';
          s.async = true;
          document.head.appendChild(s);
          window.dataLayer = window.dataLayer || [];
          function gtag() { dataLayer.push(arguments); }
          window.gtag = gtag;
          gtag('js', new Date());
          gtag('config', 'G-WZLF9K3MJB');
        }
        if ('requestIdleCallback' in window) {
          requestIdleCallback(loadGA);
        } else {
          setTimeout(loadGA, 2000);
        }
      })();
    </script>
  </body>
</html>

<style>
  .header {
    position: sticky;
    top: 0;
    background: rgba(250, 249, 246, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    z-index: 100;
    transition: background var(--transition-base),
      box-shadow var(--transition-base);
  }

  .header:hover {
    background: rgba(250, 249, 246, 0.95);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
  }

  .header__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
  }

  .header__logo {
    text-decoration: none;
  }

  .header__name {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    font-weight: 600;
    color: var(--gray-900);
  }

  .header__nav {
    display: flex;
    gap: var(--space-8);
  }

  .header__menu-btn {
    display: none;
    background: none;
    border: none;
    padding: var(--space-2);
    cursor: pointer;
    color: var(--gray-700);
  }

  @media (max-width: 768px) {
    .header__nav {
      position: fixed;
      top: 64px;
      left: 0;
      width: 100%;
      height: calc(100vh - 64px);
      background-color: var(--gray-50);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--space-8);
      transform: translateX(100%);
      transition: transform var(--transition-base);
      border-top: 1px solid var(--gray-200);
    }

    .header__nav.is-open {
      transform: translateX(0);
      display: flex;
    }

    .header__menu-btn {
      display: block;
    }
  }

  .footer {
    margin-top: var(--space-24);
    padding: var(--space-12) 0;
    background: linear-gradient(180deg, var(--gray-100), var(--gray-50));
    border-top: 1px solid rgba(0, 0, 0, 0.06);
    position: relative;
  }

  .footer::before {
    content: "";
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent,
      var(--color-accent),
      transparent
    );
    opacity: 0.3;
  }

  .footer__container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-4);
  }

  .footer__social {
    display: flex;
    gap: var(--space-4);
  }

  .footer__social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background-color: white;
    border-radius: var(--radius-md);
    color: var(--gray-600);
    box-shadow: var(--shadow-sm);
    transition: transform var(--transition-fast),
      box-shadow var(--transition-fast), color var(--transition-fast);
  }

  .footer__social-link:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: var(--shadow-md);
    color: var(--color-accent);
  }

  .footer__copyright {
    font-size: var(--text-sm);
    color: var(--gray-500);
    margin: 0;
  }
</style>

<script>
  import { addCopyButtons } from "../scripts/copyCode";
  import { initMobileMenu } from "../scripts/mobileMenu";

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", addCopyButtons);
  } else {
    addCopyButtons();
  }

  initMobileMenu();
</script>
